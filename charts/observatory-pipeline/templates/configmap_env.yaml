{{- range .Values.streams }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: stream-{{ .stream }}-env-config
  namespace: {{ $.Release.Namespace }}
  labels:
    app: stream-{{ .stream }}
  annotations:
    {{- toYaml (default $.Values.defaults.annotations .annotations) | nindent 4 }}
data:
  DEBUG_LEVEL: "{{ default $.Values.defaults.debugLevel .debugLevel }}"
  CLIENT_ID: "stream-{{ .stream }}"
  STREAM: "{{ .stream }}"
  MQTT_SERVICE_HOST: "{{ default $.Values.defaults.mqtt.broker (default (dict "broker" $.Values.defaults.mqtt.broker) .mqtt).broker }}"
  MQTT_SERVICE_PORT: "{{ default $.Values.defaults.mqtt.port (default (dict "port" $.Values.defaults.mqtt.port) .mqtt).port }}"
  MQTT_USERNAME: "{{ default $.Values.defaults.mqtt.username (default (dict "username" $.Values.defaults.mqtt.username) .mqtt).username }}"
  MQTT_PASSWORD: "{{ default $.Values.defaults.mqtt.password (default (dict "password" $.Values.defaults.mqtt.password) .mqtt).password }}"
  QOS: "{{ default $.Values.defaults.mqtt.qos (default (dict "qos" $.Values.defaults.mqtt.qos) .mqtt).qos }}"
  KEEP_ALIVE_INTERVAL: "{{ default $.Values.defaults.mqtt.keepAliveInterval (default (dict "keepAliveInterval" $.Values.defaults.mqtt.keepAliveInterval) .mqtt).keepAliveInterval }}"
  CONNECT_RETRY_INTERVAL: "{{ default $.Values.defaults.mqtt.connectRetryInterval (default (dict "connectRetryInterval" $.Values.defaults.mqtt.connectRetryInterval) .mqtt).connectRetryInterval }}"
  MQTT_TOPIC_SINK: "{{ default $.Values.defaults.mqtt.topicSink (default (dict "topicSink" $.Values.defaults.mqtt.topicSink) .mqtt).topicSink }}"
  MQTT_TOPIC_SOURCE: "{{ default $.Values.defaults.mqtt.topicSource (default (dict "topicSource" $.Values.defaults.mqtt.topicSource) .mqtt).topicSource }}"
  MQTT_TOPIC_ALL_CAMERAS: "{{ default $.Values.defaults.mqtt.topicAllCameras (default (dict "topicAllCameras" $.Values.defaults.mqtt.topicAllCameras) .mqtt).topicAllCameras }}"
  MQTT_TOPIC_DETECTIONS: "{{ default $.Values.defaults.mqtt.topicDetections (default (dict "topicDetections" $.Values.defaults.mqtt.topicDetections) .mqtt).topicDetections }}"
  MQTT_TOPIC_INFERENCE: "{{ default $.Values.defaults.mqtt.topicInference (default (dict "topicInference" $.Values.defaults.mqtt.topicInference) .mqtt).topicInference }}"
  MQTT_TOPIC_MOVEMENTS: "{{ default $.Values.defaults.mqtt.topicMovements (default (dict "topicMovements" $.Values.defaults.mqtt.topicMovements) .mqtt).topicMovements }}"
  MQTT_TOPIC_FILTERED_MOVEMENTS: "{{ default $.Values.defaults.mqtt.topicFilteredMovements (default (dict "topicFilteredMovements" $.Values.defaults.mqtt.topicFilteredMovements) .mqtt).topicFilteredMovements }}"
  MQTT_TOPIC_ALERTS: "{{ default $.Values.defaults.mqtt.topicAlerts (default (dict "topicAlerts" $.Values.defaults.mqtt.topicAlerts) .mqtt).topicAlerts }}"
  MQTT_TOPIC_STALE_ALERTS: "{{ default $.Values.defaults.mqtt.topicStaleAlerts (default (dict "topicStaleAlerts" $.Values.defaults.mqtt.topicStaleAlerts) .mqtt).topicStaleAlerts }}"
  MQTT_TOPIC_SENSORS: "{{ default $.Values.defaults.mqtt.topicSensors (default (dict "topicSensors" $.Values.defaults.mqtt.topicSensors) .mqtt).topicSensors }}"
  MQTT_TOPIC_MEASUREMENTS: "{{ default $.Values.defaults.mqtt.topicMeasurements (default (dict "topicMeasurements" $.Values.defaults.mqtt.topicMeasurements) .mqtt).topicMeasurements }}"
  MQTT_TOPIC_TOE_EVENTS: "{{ default $.Values.defaults.mqtt.topicToeEvents (default (dict "topicToeEvents" $.Values.defaults.mqtt.topicToeEvents) .mqtt).topicToeEvents }}"
  MQTT_TOPIC_TOE_COMMANDS: "{{ default $.Values.defaults.mqtt.topicToeCommands (default (dict "topicToeCommands" $.Values.defaults.mqtt.topicToeCommands) .mqtt).topicToeCommands }}"
  MQTT_TOPIC_ALL_DEVICES: "{{ default $.Values.defaults.mqtt.topicAllDevices (default (dict "topicAllDevices" $.Values.defaults.mqtt.topicAllDevices) .mqtt).topicAllDevices }}"
  FRONT_END_DEFAULT_INTERVAL: "{{ default $.Values.defaults.fe.frontEndDefaultInterval (default (dict "frontEndDefaultInterval" $.Values.defaults.fe.frontEndDefaultInterval) .fe).frontEndDefaultInterval }}"
  HISTORIAN_BASE_URL: "{{ default $.Values.defaults.historian.apiUrl (default (dict "apiUrl" $.Values.defaults.historian.apiUrl) .historian).apiUrl }}"
  RECORD_DETECTIONS_INTERVAL: "{{ default $.Values.defaults.historian.recordDetectionsInterval (default (dict "recordDetectionsInterval" $.Values.defaults.historian.recordDetectionsInterval) .historian).recordDetectionsInterval }}"
  OBJECTS_TO_FILTER: "{{ default $.Values.defaults.historian.objectsToFilter (default (dict "objectsToFilter" $.Values.defaults.historian.objectsToFilter) .historian).objectsToFilter }}"
  IOU_THRESHOLD: "{{ default $.Values.defaults.regions.iouThreshold (default (dict "iouThreshold" $.Values.defaults.regions.iouThreshold) .regions).iouThreshold }}"
  MIN_START_BEFORE_ALERT: "{{ default $.Values.defaults.video.minStartBeforeAlert (default (dict "minStartBeforeAlert" $.Values.defaults.video.minStartBeforeAlert) .video).minStartBeforeAlert }}"
  VIDEO_SEGMENT_LENGTH: "{{ default $.Values.defaults.video.segmentLength (default (dict "segmentLength" $.Values.defaults.video.segmentLength) .video).segmentLength }}"
  VIDEO_SEGMENT_RETENTION_LENGTH: "{{ default $.Values.defaults.video.segmentRetentionLength (default (dict "segmentRetentionLength" $.Values.defaults.video.segmentRetentionLength) .video).segmentRetentionLength }}"
  VIDEO_MAX_CLIP_LENGTH: "{{ default $.Values.defaults.video.maxClipLength (default (dict "maxClipLength" $.Values.defaults.video.maxClipLength) .video).maxClipLength }}"
  VIDEO_CLIP_RUNUP_LENGTH: "{{ default $.Values.defaults.video.clipRunupLength (default (dict "clipRunupLength" $.Values.defaults.video.clipRunupLength) .video).clipRunupLength }}"
  CHUNK_MAX_SIZE: "{{ default $.Values.defaults.video.chunkMaxSize (default (dict "chunkMaxSize" $.Values.defaults.video.chunkMaxSize) .video).chunkMaxSize }}"
  CHUNK_RETENTION_SECONDS: "{{ default $.Values.defaults.video.chunkRetentionSeconds (default (dict "chunkRetentionSeconds" $.Values.defaults.video.chunkRetentionSeconds) .video).chunkRetentionSeconds }}"
  VIDEO_BASE_PATH: "{{ default $.Values.defaults.video.videoBucketPath (default (dict "videoBucketPath" $.Values.defaults.video.videoBucketPath) .video).videoBucketPath }}"
  VIDEO_HAS_ANNOTATIONS: "{{ default $.Values.defaults.video.hasAnnotations (default (dict "hasAnnotations" $.Values.defaults.video.hasAnnotations) .video).hasAnnotations }}"
  ANNOTATIONS_BASE_PATH: "{{ default $.Values.defaults.video.annotationsBucketPath (default (dict "annotationsBucketPath" $.Values.defaults.video.annotationsBucketPath) .video).annotationsBucketPath }}"
  SNAPSHOT_BASE_PATH: "{{ default $.Values.defaults.video.snapshotBucketPath (default (dict "snapshotBucketPath" $.Values.defaults.video.snapshotBucketPath) .video).snapshotBucketPath }}"
  ALERT_STALE_SECONDS: "{{ default $.Values.defaults.video.staleSeconds (default (dict "staleSeconds" $.Values.defaults.video.staleSeconds) .video).staleSeconds }}"
  PERSON_DOWN_INTERVAL: "{{ default $.Values.defaults.alerts.personDownInterval (default (dict "personDownInterval" $.Values.defaults.alerts.personDownInterval) .alerts).personDownInterval }}"
  PERSON_DOWN_SCORE_THRESHOLD: "{{ default $.Values.defaults.alerts.personDownScoreThreshold (default (dict "personDownScoreThreshold" $.Values.defaults.alerts.personDownScoreThreshold) .alerts).personDownScoreThreshold }}"
  PERSON_UP_SCORE_THRESHOLD: "{{ default $.Values.defaults.alerts.personUpScoreThreshold (default (dict "personUpScoreThreshold" $.Values.defaults.alerts.personUpScoreThreshold) .alerts).personUpScoreThreshold }}"
  PERSON_DOWN_UP_TOTAL_COUNT_THRESHOLD: "{{ default $.Values.defaults.alerts.personDownUpTotalCountThreshold (default (dict "personDownUpTotalCountThreshold" $.Values.defaults.alerts.personDownUpTotalCountThreshold) .alerts).personDownUpTotalCountThreshold }}"
  LOITERING_LABELS: "{{ default $.Values.defaults.alerts.loiteringLabels (default (dict "loiteringLabels" $.Values.defaults.alerts.loiteringLabels) .alerts).loiteringLabels }}"
  SENSORS_NODE_DATA: "{{ default $.Values.defaults.alerts.sensorsNodeData (default (dict "sensorsNodeData" $.Values.defaults.alerts.sensorsNodeData) .alerts).sensorsNodeData }}"
  LOITERING_THRESHOLD: "{{ default $.Values.defaults.alerts.loiteringThreshold (default (dict "loiteringThreshold" $.Values.defaults.alerts.loiteringThreshold) .alerts).loiteringThreshold }}"
  LOITERING_CHECK_STATIONARY: "{{ default $.Values.defaults.alerts.loiteringCheckStationary (default (dict "loiteringCheckStationary" $.Values.defaults.alerts.loiteringCheckStationary) .alerts).loiteringCheckStationary }}"
  LOITERING_STATIONARY_THRESHOLD: "{{ default $.Values.defaults.alerts.loiteringStationaryThreshold (default (dict "loiteringStationaryThreshold" $.Values.defaults.alerts.loiteringStationaryThreshold) .alerts).loiteringStationaryThreshold }}"
  REPETITIVE_ALERTS_CHECK: "{{ default $.Values.defaults.alerts.repetitiveAlertsCheck (default (dict "repetitiveAlertsCheck" $.Values.defaults.alerts.repetitiveAlertsCheck) .alerts).repetitiveAlertsCheck }}"
  REPETITIVE_ALERTS_TIMESPAN: "{{ default $.Values.defaults.alerts.repetitiveAlertsTimespan (default (dict "repetitiveAlertsTimespan" $.Values.defaults.alerts.repetitiveAlertsTimespan) .alerts).repetitiveAlertsTimespan }}"
  REPETITIVE_ALERTS_IOU_THRESHOLD: "{{ default $.Values.defaults.alerts.repetitiveAlertsIouThreshold (default (dict "repetitiveAlertsIouThreshold" $.Values.defaults.alerts.repetitiveAlertsIouThreshold) .alerts).repetitiveAlertsIouThreshold }}"
  SAFE_OPEN_WINDOW_SIZE_SECONDS: "{{ default $.Values.defaults.alerts.safeOpenWindowSizeSeconds (default (dict "safeOpenWindowSizeSeconds" $.Values.defaults.alerts.safeOpenWindowSizeSeconds) .alerts).safeOpenWindowSizeSeconds }}"
  NUMBER_OF_DOMINANT_LABELS: "{{ default $.Values.defaults.alerts.numberOfDominantLabels (default (dict "numberOfDominantLabels" $.Values.defaults.alerts.numberOfDominantLabels) .alerts).numberOfDominantLabels }}"
  MOTION_ALERT_MIN_INTERVAL: "{{ default $.Values.defaults.alerts.motionAlertMinInterval (default (dict "motionAlertMinInterval" $.Values.defaults.alerts.motionAlertMinInterval) .alerts).motionAlertMinInterval }}"
  ALERT_HEATMAP_ENABLED: "{{ default $.Values.defaults.alerts.alertHeatmapEnabled (default (dict "alertHeatmapEnabled" $.Values.defaults.alerts.alertHeatmapEnabled) .alerts).alertHeatmapEnabled }}"
  ALERT_HEATMAP_GRID_SIZE: "{{ default $.Values.defaults.alerts.alertHeatmapGridSize (default (dict "alertHeatmapGridSize" $.Values.defaults.alerts.alertHeatmapGridSize) .alerts).alertHeatmapGridSize }}"
  ALERT_HEATMAP_EVENTS_RETENTION_PERIOD: "{{ default $.Values.defaults.alerts.alertHeatmapEventsRetentionPeriod (default (dict "alertHeatmapEventsRetentionPeriod" $.Values.defaults.alerts.alertHeatmapEventsRetentionPeriod) .alerts).alertHeatmapEventsRetentionPeriod }}"
  ALERT_HEATMAP_THRESHOLD_FILTER: "{{ default $.Values.defaults.alerts.alertHeatmapThresholdFilter (default (dict "alertHeatmapThresholdFilter" $.Values.defaults.alerts.alertHeatmapThresholdFilter) .alerts).alertHeatmapThresholdFilter }}"
  ALERT_HEATMAP_ALERTS_TO_FILTER: "{{ default $.Values.defaults.alerts.alertHeatmapAlertsToFilter (default (dict "alertHeatmapAlertsToFilter" $.Values.defaults.alerts.alertHeatmapAlertsToFilter) .alerts).alertHeatmapAlertsToFilter }}"
  
  # Deprecated in favor of Org Tree
  LABEL_DEVICE_ID: "{{ default $.Values.defaults.labels.deviceID (default (dict "deviceID" $.Values.defaults.labels.deviceID) .labels).deviceID }}"
  LABEL_NAMESPACE: "{{ default $.Values.defaults.labels.teamspace (default (dict "teamspace" $.Values.defaults.labels.teamspace) .labels).teamspace }}"
  LABEL_DOMAIN: "{{ default $.Values.defaults.labels.domain (default (dict "domain" $.Values.defaults.labels.domain) .labels).domain }}"
{{- end }}